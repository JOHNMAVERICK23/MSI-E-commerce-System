<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSI Gaming - Shop Products</title>
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/client-styles.css">
    <link rel="stylesheet" href="css/toast.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="navbar-container">
            <div class="navbar-brand">
                <h1>MSI Gaming</h1>
            </div>
            <ul class="navbar-menu">
                <li><a href="#" class="nav-link active"></a></li>
            </ul>
            <div class="navbar-actions">
                <button class="btn-cart" id="cartBtn">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count" id="cartCount">0</span>
                </button>
                <div class="user-dropdown">
                    <button class="btn-user" id="userBtn">
                        <i class="fas fa-user"></i>
                    </button>
                    <div id="userMenu" class="user-dropdown-content">
                        <div id="userInfo" style="padding: 10px; display: none;">
                            <strong id="userName"></strong>
                            <small id="userEmail" style="display: block;"></small>
                        </div>
                        <a href="#" id="myOrdersLink" class="menu-item">My Orders</a>
                        <a href="#" id="logoutLink" class="menu-item logout">Logout</a>
                        <div id="loginSection" style="padding: 10px;">
                            <button onclick="openLoginModal()" class="btn-login-small">Customer Login</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <section class="hero">
            <h2>Premium Gaming Components</h2>
            <p>Experience ultimate performance with MSI</p>
        </section>

        <div id="registrationSection">
            <!-- Will be populated by JavaScript -->
        </div>

        <!-- Product Filters -->
        <section class="filters-section">
            <div class="filters-container">
                <input type="text" id="searchInput" class="search-box" placeholder="Search products...">
                <select id="categoryFilter" class="filter-select">
                    <option value="">All Categories</option>
                    <option value="Graphics Card">Graphics Card</option>
                    <option value="Motherboard">Motherboard</option>
                    <option value="RAM">RAM</option>
                    <option value="Storage">Storage</option>
                </select>
            </div>
        </section>

        <!-- Products Grid -->
        <section class="products-section">
            <div id="productsList" class="products-grid">
                <p class="loading">Loading products...</p>
            </div>
        </section>
    </main>

    <!-- Modals -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <h2>Customer Login</h2>
            <form id="customerLoginForm">
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="customerUsername" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="customerPassword" required>
                </div>
                <button type="submit" class="btn-primary">Login</button>
            </form>
            <p style="text-align: center; margin-top: 15px;">
                Don't have account? <a href="#" onclick="openRegisterModal()">Register here</a>
            </p>
        </div>
    </div>

    <div id="registerModal" class="modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <h2>Create Account</h2>
            <form id="customerRegisterForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>First Name</label>
                        <input type="text" id="regFirstName" required>
                    </div>
                    <div class="form-group">
                        <label>Last Name</label>
                        <input type="text" id="regLastName" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="regUsername" required>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="regEmail" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="regPassword" required>
                </div>
                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="tel" id="regPhone" required>
                </div>
                <button type="submit" class="btn-primary">Create Account</button>
            </form>
        </div>
    </div>

    <div id="productModal" class="modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <div class="detail-grid">
                <div class="detail-image">
                    <i class="fas fa-box"></i>
                </div>
                <div class="detail-info">
                    <h2 id="detailName">Product Name</h2>
                    <p class="detail-category" id="detailCategory">Category</p>
                    <p class="detail-description" id="detailDescription">Description</p>
                    
                    <div class="detail-specs">
                        <div class="spec">
                            <span>Price:</span>
                            <span class="price" id="detailPrice">$0.00</span>
                        </div>
                        <div class="spec">
                            <span>Stock:</span>
                            <span id="detailStock">0 available</span>
                        </div>
                    </div>
    
                    <div class="quantity-selector">
                        <button class="qty-btn" id="decreaseQty">-</button>
                        <input type="number" id="quantityInput" value="1" min="1" max="100">
                        <button class="qty-btn" id="increaseQty">+</button>
                    </div>
    
                    <button class="btn-add-to-cart" id="addToCartBtn">
                        <i class="fas fa-shopping-cart"></i> Add to Cart
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- OVERLAY FOR MODALS -->
    <div id="overlay" class="overlay"></div>
    
    <!-- CART SIDEBAR -->
    <div id="cartSidebar" class="cart-sidebar">
        <div class="cart-header">
            <h3>Shopping Cart</h3>
            <button class="close-cart" id="closeCartBtn">&times;</button>
        </div>
        <div class="cart-items" id="cartItems">
            <p class="empty-cart">Your cart is empty</p>
        </div>
        <div class="cart-footer">
            <div class="cart-total">
                <span>Total:</span>
                <span id="cartTotal">$0.00</span>
            </div>
            <button class="btn-checkout" id="checkoutBtn">
                <i class="fas fa-credit-card"></i> Checkout
            </button>
            <button class="btn-continue" id="continueShopping">
                <i class="fas fa-arrow-left"></i> Continue Shopping
            </button>
        </div>
    </div>
    <script src="js/toast.js"></script>      
    <script src="js/auth.js"></script>       
    <script src="js/client.js"></script>     
    
    <script>
    // Registration/Login logic for index.html
    document.addEventListener('DOMContentLoaded', () => {
        const user = getUser();
        const registrationSection = document.getElementById('registrationSection');
        
        if (user && user.role === 'customer') {
            // User is logged in
            registrationSection.innerHTML = `
                <div class="welcome-banner">
                    <h2>Welcome back, ${user.first_name || user.username}!</h2>
                    <p>Continue shopping for the best gaming components</p>
                </div>
            `;
            
            // Update user info in dropdown
            document.getElementById('userName').textContent = `${user.first_name} ${user.last_name}`;
            document.getElementById('userEmail').textContent = user.email;
            document.getElementById('userInfo').style.display = 'block';
            document.getElementById('loginSection').style.display = 'none';
        } else {
            // User is not logged in
            registrationSection.innerHTML = `
                <div class="registration-banner">
                    <h2>Start Your Gaming Journey</h2>
                    <p>Create an account to get personalized recommendations and faster checkout</p>
                    <div class="banner-buttons">
                        <button class="btn-primary" onclick="openRegisterModal()">
                            <i class="fas fa-user-plus"></i> Create Account
                        </button>
                        <button class="btn-secondary" onclick="openLoginModal()">
                            <i class="fas fa-sign-in-alt"></i> Login
                        </button>
                    </div>
                </div>
            `;
        }
        
        // Setup modal forms
        const loginForm = document.getElementById('customerLoginForm');
        if (loginForm) {
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                await handleQuickLogin(e);
            });
        }
        
        const registerForm = document.getElementById('customerRegisterForm');
        if (registerForm) {
            registerForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                await handleQuickRegister();
            });
        }

        // ============================================
        // Cart sidebar close button
        // ============================================
        const closeCartBtn = document.getElementById('closeCartBtn');
        if (closeCartBtn) {
            closeCartBtn.addEventListener('click', (e) => {
                e.preventDefault();
                const cartSidebar = document.getElementById('cartSidebar');
                const overlay = document.getElementById('overlay');
                
                if (cartSidebar) cartSidebar.classList.remove('active');
                if (overlay) overlay.classList.remove('active');
            });
        }
    });
    
    function openLoginModal() {
        document.getElementById('loginModal').classList.add('active');
        document.getElementById('overlay').classList.add('active');
    }
    
    function openRegisterModal() {
        document.getElementById('registerModal').classList.add('active');
        document.getElementById('overlay').classList.add('active');
    }
    
    async function handleQuickRegister() {
        const firstName = document.getElementById('regFirstName').value.trim();
        const lastName = document.getElementById('regLastName').value.trim();
        const username = document.getElementById('regUsername').value.trim();
        const email = document.getElementById('regEmail').value.trim();
        const password = document.getElementById('regPassword').value.trim();
        const phone = document.getElementById('regPhone').value.trim();
        
        try {
            const response = await fetch('php/auth.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    action: 'register_customer',
                    firstName: firstName,
                    lastName: lastName,
                    username: username,
                    email: email,
                    password: password,
                    phone: phone
                })
            });
            
            const data = await response.json();
            
            if (data.status === 'success') {
                toast.success('Success', 'Account created! Please login.');
                document.getElementById('registerModal').classList.remove('active');
                document.getElementById('overlay').classList.remove('active');
                document.getElementById('customerRegisterForm').reset();
                
                setTimeout(() => openLoginModal(), 1000);
            } else {
                toast.error('Registration Failed', data.message);
            }
        } catch (error) {
            console.error('Error:', error);
            toast.error('Error', 'An error occurred during registration');
        }
    }
    </script>
</body>
</html>